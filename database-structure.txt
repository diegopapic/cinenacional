# Estructura de Base de Datos - CineNacional
# Generado automáticamente el: 2025-07-29T22:57:02.252Z
# ================================================

## Schema Prisma

```prisma
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")  // IMPORTANTE: Esto hace que use DIRECT_URL para migraciones
}

// =====================================================
// MODELOS PRINCIPALES
// =====================================================

model Movie {
  id               Int      @id @default(autoincrement())
  slug             String   @unique @db.VarChar(255)
  title            String   @db.VarChar(255)
  year             Int
  releaseDate      DateTime? @map("release_date") @db.Date
  duration         Int?     // en minutos
  durationSeconds  Int?     @map("duration_seconds")
  tipoDuracion     String?  @map("tipo_duracion") @db.VarChar(20)
  synopsis         String?  @db.Text
  tagline          String?  @db.VarChar(500)
  posterUrl        String?  @map("poster_url") @db.VarChar(500)
  trailerUrl       String?  @map("trailer_url") @db.VarChar(500)
  imdbId           String?  @map("imdb_id") @db.VarChar(20)
  
  // Información técnica
  colorType        String?  @map("color_type") @db.VarChar(50)
  soundType        String?  @map("sound_type") @db.VarChar(50)
  
  // Información legal
  ratingId          Int?     @map("rating_id")
  rating            Rating?  @relation(fields: [ratingId], references: [id])
  
  // Status y timestamps
  status           MovieStatus @default(PUBLISHED)
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")
  dataCompleteness DataCompleteness @default(BASIC_PRESS_KIT) @map("data_completeness")
  
  // SEO
  metaDescription  String?  @map("meta_description") @db.Text
  metaKeywords     String[] @map("meta_keywords")
  
  // Relaciones
  cast             MovieCast[]
  crew             MovieCrew[]
  genres           MovieGenre[]
  productionCompanies MovieProductionCompany[]
  distributionCompanies MovieDistributionCompany[]
  images           MovieImage[]
  videos           MovieVideo[]
  awards           MovieAward[]
  themes           MovieTheme[]
  countries        MovieCountry[]
  languages        MovieLanguage[]
  filmingLocations FilmingLocation[]
  userRatings      UserRating[]
  watchlists       UserWatchlist[]
  watchedBy        UserWatched[]
  
  @@map("movies")
  @@index([slug])
  @@index([title])
  @@index([year])
  @@index([status])
  @@index([tipoDuracion])
  @@index([ratingId])
}

model Person {
  id              Int      @id @default(autoincrement())
  slug            String   @unique @db.VarChar(255)
  name            String   @db.VarChar(255)
  birthName       String?  @map("birth_name") @db.VarChar(255)
  birthDate       DateTime? @map("birth_date") @db.Date
  deathDate       DateTime? @map("death_date") @db.Date
  birthPlace      String?  @map("birth_place") @db.VarChar(255)
  nationality     String?  @db.VarChar(100)
  biography       String?  @db.Text
  photoUrl        String?  @map("photo_url") @db.VarChar(500)
  gender          String?  @db.VarChar(20)
  
  // Links externos
  imdbId          String?  @map("imdb_id") @db.VarChar(20)
  wikipediaUrl    String?  @map("wikipedia_url") @db.VarChar(500)
  officialWebsite String?  @map("official_website") @db.VarChar(500)
  
  // Redes sociales
  instagramHandle String?  @map("instagram_handle") @db.VarChar(100)
  twitterHandle   String?  @map("twitter_handle") @db.VarChar(100)
  facebookUrl     String?  @map("facebook_url") @db.VarChar(500)
  
  // Timestamps
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  // Relaciones
  castRoles       MovieCast[]
  crewRoles       MovieCrew[]
  awards          MovieAward[]
  
  @@map("people")
  @@index([slug])
  @@index([name])
}

model Genre {
  id          Int      @id @default(autoincrement())
  slug        String   @unique @db.VarChar(100)
  name        String   @db.VarChar(100)
  description String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  
  // Relaciones
  movies      MovieGenre[]
  
  @@map("genres")
}

model ProductionCompany {
  id          Int      @id @default(autoincrement())
  slug        String   @unique @db.VarChar(255)
  name        String   @db.VarChar(255)
  description String?  @db.Text
  foundedYear Int?     @map("founded_year")
  logoUrl     String?  @map("logo_url") @db.VarChar(500)
  website     String?  @db.VarChar(500)
  country     String?  @db.VarChar(100)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  // Relaciones
  movies      MovieProductionCompany[]
  
  @@map("production_companies")
}

model DistributionCompany {
  id          Int      @id @default(autoincrement())
  slug        String   @unique @db.VarChar(255)
  name        String   @db.VarChar(255)
  description String?  @db.Text
  logoUrl     String?  @map("logo_url") @db.VarChar(500)
  website     String?  @db.VarChar(500)
  country     String?  @db.VarChar(100)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  // Relaciones
  movies      MovieDistributionCompany[]
  
  @@map("distribution_companies")
}

enum DataCompleteness {
  BASIC_PRESS_KIT     // Gacetilla básica
  FULL_PRESS_KIT      // Gacetilla completa
  MAIN_CAST           // Intérpretes principales
  MAIN_CREW           // Técnicos principales  
  FULL_CAST           // Todos los intérpretes
  FULL_CREW           // Todos los técnicos
  
  @@map("data_completeness")
}

// =====================================================
// MODELOS DE RELACIÓN
// =====================================================

model MovieCast {
  id            Int      @id @default(autoincrement())
  movieId       Int      @map("movie_id")
  personId      Int      @map("person_id")
  characterName String?  @map("character_name") @db.VarChar(255)
  billingOrder  Int?     @map("billing_order")
  isPrincipal   Boolean  @default(false) @map("is_principal")
  notes         String?  @db.Text
  createdAt     DateTime @default(now()) @map("created_at")
  
  // Relaciones
  movie         Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  person        Person   @relation(fields: [personId], references: [id], onDelete: Cascade)
  
  @@unique([movieId, personId, characterName])
  @@map("movie_cast")
  @@index([movieId])
  @@index([personId])
}

model MovieCrew {
  id           Int      @id @default(autoincrement())
  movieId      Int      @map("movie_id")
  personId     Int      @map("person_id")
  role         String   @db.VarChar(100) // 'Director', 'Guionista', etc.
  department   String?  @db.VarChar(100)
  jobTitle     String?  @map("job_title") @db.VarChar(255)
  billingOrder Int?     @map("billing_order")
  notes        String?  @db.Text
  createdAt    DateTime @default(now()) @map("created_at")
  
  // Relaciones
  movie        Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  person       Person   @relation(fields: [personId], references: [id], onDelete: Cascade)
  
  @@unique([movieId, personId, role])
  @@map("movie_crew")
  @@index([movieId])
  @@index([personId])
  @@index([role])
}

model MovieGenre {
  movieId   Int     @map("movie_id")
  genreId   Int     @map("genre_id")
  isPrimary Boolean @default(false) @map("is_primary")
  
  // Relaciones
  movie     Movie   @relation(fields: [movieId], references: [id], onDelete: Cascade)
  genre     Genre   @relation(fields: [genreId], references: [id], onDelete: Cascade)
  
  @@id([movieId, genreId])
  @@map("movie_genres")
}

model MovieProductionCompany {
  movieId   Int     @map("movie_id")
  companyId Int     @map("company_id")
  isPrimary Boolean @default(false) @map("is_primary")
  
  // Relaciones
  movie     Movie             @relation(fields: [movieId], references: [id], onDelete: Cascade)
  company   ProductionCompany @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  @@id([movieId, companyId])
  @@map("movie_production_companies")
}

model MovieDistributionCompany {
  movieId   Int    @map("movie_id")
  companyId Int    @map("company_id")
  territory String @default("Argentina") @db.VarChar(100)
  
  // Relaciones
  movie     Movie               @relation(fields: [movieId], references: [id], onDelete: Cascade)
  company   DistributionCompany @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  @@id([movieId, companyId, territory])
  @@map("movie_distribution_companies")
}

// =====================================================
// CONTENIDO MULTIMEDIA
// =====================================================

model MovieImage {
  id           Int      @id @default(autoincrement())
  movieId      Int      @map("movie_id")
  url          String   @db.VarChar(500)
  type         ImageType
  width        Int?
  height       Int?
  caption      String?  @db.Text
  photographer String?  @db.VarChar(255)
  displayOrder Int      @default(0) @map("display_order")
  isPrimary    Boolean  @default(false) @map("is_primary")
  createdAt    DateTime @default(now()) @map("created_at")
  
  // Relaciones
  movie        Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  
  @@map("movie_images")
}

model MovieVideo {
  id        Int      @id @default(autoincrement())
  movieId   Int      @map("movie_id")
  url       String   @db.VarChar(500)
  platform  String?  @db.VarChar(50)
  videoKey  String?  @map("video_key") @db.VarChar(100)
  type      VideoType
  title     String?  @db.VarChar(255)
  duration  Int?     // en segundos
  language  String   @default("es") @db.VarChar(10)
  isPrimary Boolean  @default(false) @map("is_primary")
  createdAt DateTime @default(now()) @map("created_at")
  
  // Relaciones
  movie     Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  
  @@map("movie_videos")
}

// =====================================================
// INFORMACIÓN ADICIONAL
// =====================================================

model Award {
  id           Int      @id @default(autoincrement())
  name         String   @db.VarChar(255)
  organization String?  @db.VarChar(255)
  country      String?  @db.VarChar(100)
  description  String?  @db.Text
  logoUrl      String?  @map("logo_url") @db.VarChar(500)
  createdAt    DateTime @default(now()) @map("created_at")
  
  // Relaciones
  movieAwards  MovieAward[]
  
  @@map("awards")
}

model MovieAward {
  id                Int      @id @default(autoincrement())
  movieId           Int      @map("movie_id")
  awardId           Int      @map("award_id")
  category          String   @db.VarChar(255)
  year              Int
  result            AwardResult
  recipientPersonId Int?     @map("recipient_person_id")
  notes             String?  @db.Text
  createdAt         DateTime @default(now()) @map("created_at")
  
  // Relaciones
  movie             Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  award             Award    @relation(fields: [awardId], references: [id], onDelete: Cascade)
  recipient         Person?  @relation(fields: [recipientPersonId], references: [id])
  
  @@map("movie_awards")
}

model Theme {
  id          Int      @id @default(autoincrement())
  slug        String   @unique @db.VarChar(100)
  name        String   @db.VarChar(100)
  description String?  @db.Text
  usageCount  Int      @default(0) @map("usage_count") // NUEVO: contador de uso
  createdAt   DateTime @default(now()) @map("created_at")
  
  // Relaciones
  movies      MovieTheme[]
  
  @@map("themes")
  @@index([slug])
  @@index([name])
}

model Rating {
  id              Int      @id @default(autoincrement())
  slug            String   @unique @db.VarChar(100)
  name            String   @unique @db.VarChar(255)
  abbreviation    String?  @db.VarChar(10)
  description     String?  @db.Text
  order           Int      @default(0)
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  // Relaciones
  movies          Movie[]
  
  @@map("ratings")
  @@index([slug])
  @@index([order])
}

model MovieTheme {
  movieId   Int @map("movie_id")
  themeId   Int @map("theme_id")
  relevance Int @default(1) // 1-5
  
  // Relaciones
  movie     Movie @relation(fields: [movieId], references: [id], onDelete: Cascade)
  theme     Theme @relation(fields: [themeId], references: [id], onDelete: Cascade)
  
  @@id([movieId, themeId])
  @@map("movie_themes")
}

model Country {
  id        Int      @id @default(autoincrement())
  code      String   @unique @db.VarChar(2)
  name      String   @db.VarChar(100)
  createdAt DateTime @default(now()) @map("created_at")
  
  // Relaciones
  movies    MovieCountry[]
  
  @@map("countries")
}

model MovieCountry {
  movieId   Int     @map("movie_id")
  countryId Int     @map("country_id")
  isPrimary Boolean @default(false) @map("is_primary")
  
  // Relaciones
  movie     Movie   @relation(fields: [movieId], references: [id], onDelete: Cascade)
  country   Country @relation(fields: [countryId], references: [id], onDelete: Cascade)
  
  @@id([movieId, countryId])
  @@map("movie_countries")
}

model Language {
  id        Int      @id @default(autoincrement())
  code      String   @unique @db.VarChar(10)
  name      String   @db.VarChar(100)
  createdAt DateTime @default(now()) @map("created_at")
  
  // Relaciones
  movies    MovieLanguage[]
  
  @@map("languages")
}

model MovieLanguage {
  movieId    Int     @map("movie_id")
  languageId Int     @map("language_id")
  isPrimary  Boolean @default(false) @map("is_primary")
  
  // Relaciones
  movie      Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  language   Language @relation(fields: [languageId], references: [id], onDelete: Cascade)
  
  @@id([movieId, languageId])
  @@map("movie_languages")
}

model FilmingLocation {
  id           Int      @id @default(autoincrement())
  movieId      Int      @map("movie_id")
  locationName String   @map("location_name") @db.VarChar(255)
  city         String?  @db.VarChar(100)
  province     String?  @db.VarChar(100)
  country      String?  @db.VarChar(100)
  latitude     Decimal? @db.Decimal(10, 8)
  longitude    Decimal? @db.Decimal(11, 8)
  notes        String?  @db.Text
  createdAt    DateTime @default(now()) @map("created_at")
  
  // Relaciones
  movie        Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  
  @@map("filming_locations")
}

// =====================================================
// USUARIOS Y INTERACCIONES
// =====================================================

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique @db.VarChar(255)
  username     String   @unique @db.VarChar(100)
  passwordHash String   @map("password_hash") @db.VarChar(255)
  displayName  String?  @map("display_name") @db.VarChar(255)
  avatarUrl    String?  @map("avatar_url") @db.VarChar(500)
  bio          String?  @db.Text
  isActive     Boolean  @default(true) @map("is_active")
  isAdmin      Boolean  @default(false) @map("is_admin")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  
  // Relaciones
  ratings      UserRating[]
  watchlist    UserWatchlist[]
  watched      UserWatched[]
  
  @@map("users")
}

model UserRating {
  userId     Int      @map("user_id")
  movieId    Int      @map("movie_id")
  rating     Decimal  @db.Decimal(3, 1)
  reviewText String?  @map("review_text") @db.Text
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  
  // Relaciones
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  movie      Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  
  @@id([userId, movieId])
  @@map("user_ratings")
}

model UserWatchlist {
  userId    Int      @map("user_id")
  movieId   Int      @map("movie_id")
  addedAt   DateTime @default(now()) @map("added_at")
  
  // Relaciones
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  movie     Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  
  @@id([userId, movieId])
  @@map("user_watchlist")
}

model UserWatched {
  userId    Int      @map("user_id")
  movieId   Int      @map("movie_id")
  watchedAt DateTime @default(now()) @map("watched_at")
  
  // Relaciones
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  movie     Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  
  @@id([userId, movieId])
  @@map("user_watched")
}

// =====================================================
// ENUMS
// =====================================================

enum MovieStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
  
  @@map("movie_status")
}

enum ImageType {
  POSTER
  BACKDROP
  STILL
  BEHIND_SCENES
  
  @@map("image_type")
}

enum VideoType {
  TRAILER
  TEASER
  BEHIND_SCENES
  INTERVIEW
  CLIP
  
  @@map("video_type")
}

enum AwardResult {
  WON
  NOMINATED
  
  @@map("award_result")
}
```

## SQL Generado

```sql
-- CreateEnum
CREATE TYPE "data_completeness" AS ENUM ('BASIC_PRESS_KIT', 'FULL_PRESS_KIT', 'MAIN_CAST', 'MAIN_CREW', 'FULL_CAST', 'FULL_CREW');

-- CreateEnum
CREATE TYPE "movie_status" AS ENUM ('DRAFT', 'PUBLISHED', 'ARCHIVED');

-- CreateEnum
CREATE TYPE "image_type" AS ENUM ('POSTER', 'BACKDROP', 'STILL', 'BEHIND_SCENES');

-- CreateEnum
CREATE TYPE "video_type" AS ENUM ('TRAILER', 'TEASER', 'BEHIND_SCENES', 'INTERVIEW', 'CLIP');

-- CreateEnum
CREATE TYPE "award_result" AS ENUM ('WON', 'NOMINATED');

-- CreateTable
CREATE TABLE "movies" (
    "id" SERIAL NOT NULL,
    "slug" VARCHAR(255) NOT NULL,
    "title" VARCHAR(255) NOT NULL,
    "year" INTEGER NOT NULL,
    "release_date" DATE,
    "duration" INTEGER,
    "duration_seconds" INTEGER,
    "tipo_duracion" VARCHAR(20),
    "synopsis" TEXT,
    "tagline" VARCHAR(500),
    "poster_url" VARCHAR(500),
    "trailer_url" VARCHAR(500),
    "imdb_id" VARCHAR(20),
    "color_type" VARCHAR(50),
    "sound_type" VARCHAR(50),
    "rating_id" INTEGER,
    "status" "movie_status" NOT NULL DEFAULT 'PUBLISHED',
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,
    "data_completeness" "data_completeness" NOT NULL DEFAULT 'BASIC_PRESS_KIT',
    "meta_description" TEXT,
    "meta_keywords" TEXT[],

    CONSTRAINT "movies_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "people" (
    "id" SERIAL NOT NULL,
    "slug" VARCHAR(255) NOT NULL,
    "name" VARCHAR(255) NOT NULL,
    "birth_name" VARCHAR(255),
    "birth_date" DATE,
    "death_date" DATE,
    "birth_place" VARCHAR(255),
    "nationality" VARCHAR(100),
    "biography" TEXT,
    "photo_url" VARCHAR(500),
    "gender" VARCHAR(20),
    "imdb_id" VARCHAR(20),
    "wikipedia_url" VARCHAR(500),
    "official_website" VARCHAR(500),
    "instagram_handle" VARCHAR(100),
    "twitter_handle" VARCHAR(100),
    "facebook_url" VARCHAR(500),
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "people_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "genres" (
    "id" SERIAL NOT NULL,
    "slug" VARCHAR(100) NOT NULL,
    "name" VARCHAR(100) NOT NULL,
    "description" TEXT,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "genres_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "production_companies" (
    "id" SERIAL NOT NULL,
    "slug" VARCHAR(255) NOT NULL,
    "name" VARCHAR(255) NOT NULL,
    "description" TEXT,
    "founded_year" INTEGER,
    "logo_url" VARCHAR(500),
    "website" VARCHAR(500),
    "country" VARCHAR(100),
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "production_companies_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "distribution_companies" (
    "id" SERIAL NOT NULL,
    "slug" VARCHAR(255) NOT NULL,
    "name" VARCHAR(255) NOT NULL,
    "description" TEXT,
    "logo_url" VARCHAR(500),
    "website" VARCHAR(500),
    "country" VARCHAR(100),
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "distribution_companies_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "movie_cast" (
    "id" SERIAL NOT NULL,
    "movie_id" INTEGER NOT NULL,
    "person_id" INTEGER NOT NULL,
    "character_name" VARCHAR(255),
    "billing_order" INTEGER,
    "is_principal" BOOLEAN NOT NULL DEFAULT false,
    "notes" TEXT,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "movie_cast_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "movie_crew" (
    "id" SERIAL NOT NULL,
    "movie_id" INTEGER NOT NULL,
    "person_id" INTEGER NOT NULL,
    "role" VARCHAR(100) NOT NULL,
    "department" VARCHAR(100),
    "job_title" VARCHAR(255),
    "billing_order" INTEGER,
    "notes" TEXT,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "movie_crew_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "movie_genres" (
    "movie_id" INTEGER NOT NULL,
    "genre_id" INTEGER NOT NULL,
    "is_primary" BOOLEAN NOT NULL DEFAULT false,

    CONSTRAINT "movie_genres_pkey" PRIMARY KEY ("movie_id","genre_id")
);

-- CreateTable
CREATE TABLE "movie_production_companies" (
    "movie_id" INTEGER NOT NULL,
    "company_id" INTEGER NOT NULL,
    "is_primary" BOOLEAN NOT NULL DEFAULT false,

    CONSTRAINT "movie_production_companies_pkey" PRIMARY KEY ("movie_id","company_id")
);

-- CreateTable
CREATE TABLE "movie_distribution_companies" (
    "movie_id" INTEGER NOT NULL,
    "company_id" INTEGER NOT NULL,
    "territory" VARCHAR(100) NOT NULL DEFAULT 'Argentina',

    CONSTRAINT "movie_distribution_companies_pkey" PRIMARY KEY ("movie_id","company_id","territory")
);

-- CreateTable
CREATE TABLE "movie_images" (
    "id" SERIAL NOT NULL,
    "movie_id" INTEGER NOT NULL,
    "url" VARCHAR(500) NOT NULL,
    "type" "image_type" NOT NULL,
    "width" INTEGER,
    "height" INTEGER,
    "caption" TEXT,
    "photographer" VARCHAR(255),
    "display_order" INTEGER NOT NULL DEFAULT 0,
    "is_primary" BOOLEAN NOT NULL DEFAULT false,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "movie_images_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "movie_videos" (
    "id" SERIAL NOT NULL,
    "movie_id" INTEGER NOT NULL,
    "url" VARCHAR(500) NOT NULL,
    "platform" VARCHAR(50),
    "video_key" VARCHAR(100),
    "type" "video_type" NOT NULL,
    "title" VARCHAR(255),
    "duration" INTEGER,
    "language" VARCHAR(10) NOT NULL DEFAULT 'es',
    "is_primary" BOOLEAN NOT NULL DEFAULT false,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "movie_videos_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "awards" (
    "id" SERIAL NOT NULL,
    "name" VARCHAR(255) NOT NULL,
    "organization" VARCHAR(255),
    "country" VARCHAR(100),
    "description" TEXT,
    "logo_url" VARCHAR(500),
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "awards_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "movie_awards" (
    "id" SERIAL NOT NULL,
    "movie_id" INTEGER NOT NULL,
    "award_id" INTEGER NOT NULL,
    "category" VARCHAR(255) NOT NULL,
    "year" INTEGER NOT NULL,
    "result" "award_result" NOT NULL,
    "recipient_person_id" INTEGER,
    "notes" TEXT,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "movie_awards_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "themes" (
    "id" SERIAL NOT NULL,
    "slug" VARCHAR(100) NOT NULL,
    "name" VARCHAR(100) NOT NULL,
    "description" TEXT,
    "usage_count" INTEGER NOT NULL DEFAULT 0,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "themes_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "ratings" (
    "id" SERIAL NOT NULL,
    "slug" VARCHAR(100) NOT NULL,
    "name" VARCHAR(255) NOT NULL,
    "abbreviation" VARCHAR(10),
    "description" TEXT,
    "order" INTEGER NOT NULL DEFAULT 0,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "ratings_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "movie_themes" (
    "movie_id" INTEGER NOT NULL,
    "theme_id" INTEGER NOT NULL,
    "relevance" INTEGER NOT NULL DEFAULT 1,

    CONSTRAINT "movie_themes_pkey" PRIMARY KEY ("movie_id","theme_id")
);

-- CreateTable
CREATE TABLE "countries" (
    "id" SERIAL NOT NULL,
    "code" VARCHAR(2) NOT NULL,
    "name" VARCHAR(100) NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "countries_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "movie_countries" (
    "movie_id" INTEGER NOT NULL,
    "country_id" INTEGER NOT NULL,
    "is_primary" BOOLEAN NOT NULL DEFAULT false,

    CONSTRAINT "movie_countries_pkey" PRIMARY KEY ("movie_id","country_id")
);

-- CreateTable
CREATE TABLE "languages" (
    "id" SERIAL NOT NULL,
    "code" VARCHAR(10) NOT NULL,
    "name" VARCHAR(100) NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "languages_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "movie_languages" (
    "movie_id" INTEGER NOT NULL,
    "language_id" INTEGER NOT NULL,
    "is_primary" BOOLEAN NOT NULL DEFAULT false,

    CONSTRAINT "movie_languages_pkey" PRIMARY KEY ("movie_id","language_id")
);

-- CreateTable
CREATE TABLE "filming_locations" (
    "id" SERIAL NOT NULL,
    "movie_id" INTEGER NOT NULL,
    "location_name" VARCHAR(255) NOT NULL,
    "city" VARCHAR(100),
    "province" VARCHAR(100),
    "country" VARCHAR(100),
    "latitude" DECIMAL(10,8),
    "longitude" DECIMAL(11,8),
    "notes" TEXT,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "filming_locations_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "users" (
    "id" SERIAL NOT NULL,
    "email" VARCHAR(255) NOT NULL,
    "username" VARCHAR(100) NOT NULL,
    "password_hash" VARCHAR(255) NOT NULL,
    "display_name" VARCHAR(255),
    "avatar_url" VARCHAR(500),
    "bio" TEXT,
    "is_active" BOOLEAN NOT NULL DEFAULT true,
    "is_admin" BOOLEAN NOT NULL DEFAULT false,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "users_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "user_ratings" (
    "user_id" INTEGER NOT NULL,
    "movie_id" INTEGER NOT NULL,
    "rating" DECIMAL(3,1) NOT NULL,
    "review_text" TEXT,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "user_ratings_pkey" PRIMARY KEY ("user_id","movie_id")
);

-- CreateTable
CREATE TABLE "user_watchlist" (
    "user_id" INTEGER NOT NULL,
    "movie_id" INTEGER NOT NULL,
    "added_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "user_watchlist_pkey" PRIMARY KEY ("user_id","movie_id")
);

-- CreateTable
CREATE TABLE "user_watched" (
    "user_id" INTEGER NOT NULL,
    "movie_id" INTEGER NOT NULL,
    "watched_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "user_watched_pkey" PRIMARY KEY ("user_id","movie_id")
);

-- CreateIndex
CREATE UNIQUE INDEX "movies_slug_key" ON "movies"("slug");

-- CreateIndex
CREATE INDEX "movies_slug_idx" ON "movies"("slug");

-- CreateIndex
CREATE INDEX "movies_title_idx" ON "movies"("title");

-- CreateIndex
CREATE INDEX "movies_year_idx" ON "movies"("year");

-- CreateIndex
CREATE INDEX "movies_status_idx" ON "movies"("status");

-- CreateIndex
CREATE INDEX "movies_tipo_duracion_idx" ON "movies"("tipo_duracion");

-- CreateIndex
CREATE INDEX "movies_rating_id_idx" ON "movies"("rating_id");

-- CreateIndex
CREATE UNIQUE INDEX "people_slug_key" ON "people"("slug");

-- CreateIndex
CREATE INDEX "people_slug_idx" ON "people"("slug");

-- CreateIndex
CREATE INDEX "people_name_idx" ON "people"("name");

-- CreateIndex
CREATE UNIQUE INDEX "genres_slug_key" ON "genres"("slug");

-- CreateIndex
CREATE UNIQUE INDEX "production_companies_slug_key" ON "production_companies"("slug");

-- CreateIndex
CREATE UNIQUE INDEX "distribution_companies_slug_key" ON "distribution_companies"("slug");

-- CreateIndex
CREATE INDEX "movie_cast_movie_id_idx" ON "movie_cast"("movie_id");

-- CreateIndex
CREATE INDEX "movie_cast_person_id_idx" ON "movie_cast"("person_id");

-- CreateIndex
CREATE UNIQUE INDEX "movie_cast_movie_id_person_id_character_name_key" ON "movie_cast"("movie_id", "person_id", "character_name");

-- CreateIndex
CREATE INDEX "movie_crew_movie_id_idx" ON "movie_crew"("movie_id");

-- CreateIndex
CREATE INDEX "movie_crew_person_id_idx" ON "movie_crew"("person_id");

-- CreateIndex
CREATE INDEX "movie_crew_role_idx" ON "movie_crew"("role");

-- CreateIndex
CREATE UNIQUE INDEX "movie_crew_movie_id_person_id_role_key" ON "movie_crew"("movie_id", "person_id", "role");

-- CreateIndex
CREATE UNIQUE INDEX "themes_slug_key" ON "themes"("slug");

-- CreateIndex
CREATE INDEX "themes_slug_idx" ON "themes"("slug");

-- CreateIndex
CREATE INDEX "themes_name_idx" ON "themes"("name");

-- CreateIndex
CREATE UNIQUE INDEX "ratings_slug_key" ON "ratings"("slug");

-- CreateIndex
CREATE UNIQUE INDEX "ratings_name_key" ON "ratings"("name");

-- CreateIndex
CREATE INDEX "ratings_slug_idx" ON "ratings"("slug");

-- CreateIndex
CREATE INDEX "ratings_order_idx" ON "ratings"("order");

-- CreateIndex
CREATE UNIQUE INDEX "countries_code_key" ON "countries"("code");

-- CreateIndex
CREATE UNIQUE INDEX "languages_code_key" ON "languages"("code");

-- CreateIndex
CREATE UNIQUE INDEX "users_email_key" ON "users"("email");

-- CreateIndex
CREATE UNIQUE INDEX "users_username_key" ON "users"("username");

-- AddForeignKey
ALTER TABLE "movies" ADD CONSTRAINT "movies_rating_id_fkey" FOREIGN KEY ("rating_id") REFERENCES "ratings"("id") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_cast" ADD CONSTRAINT "movie_cast_movie_id_fkey" FOREIGN KEY ("movie_id") REFERENCES "movies"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_cast" ADD CONSTRAINT "movie_cast_person_id_fkey" FOREIGN KEY ("person_id") REFERENCES "people"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_crew" ADD CONSTRAINT "movie_crew_movie_id_fkey" FOREIGN KEY ("movie_id") REFERENCES "movies"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_crew" ADD CONSTRAINT "movie_crew_person_id_fkey" FOREIGN KEY ("person_id") REFERENCES "people"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_genres" ADD CONSTRAINT "movie_genres_movie_id_fkey" FOREIGN KEY ("movie_id") REFERENCES "movies"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_genres" ADD CONSTRAINT "movie_genres_genre_id_fkey" FOREIGN KEY ("genre_id") REFERENCES "genres"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_production_companies" ADD CONSTRAINT "movie_production_companies_movie_id_fkey" FOREIGN KEY ("movie_id") REFERENCES "movies"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_production_companies" ADD CONSTRAINT "movie_production_companies_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "production_companies"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_distribution_companies" ADD CONSTRAINT "movie_distribution_companies_movie_id_fkey" FOREIGN KEY ("movie_id") REFERENCES "movies"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_distribution_companies" ADD CONSTRAINT "movie_distribution_companies_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "distribution_companies"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_images" ADD CONSTRAINT "movie_images_movie_id_fkey" FOREIGN KEY ("movie_id") REFERENCES "movies"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_videos" ADD CONSTRAINT "movie_videos_movie_id_fkey" FOREIGN KEY ("movie_id") REFERENCES "movies"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_awards" ADD CONSTRAINT "movie_awards_movie_id_fkey" FOREIGN KEY ("movie_id") REFERENCES "movies"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_awards" ADD CONSTRAINT "movie_awards_award_id_fkey" FOREIGN KEY ("award_id") REFERENCES "awards"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_awards" ADD CONSTRAINT "movie_awards_recipient_person_id_fkey" FOREIGN KEY ("recipient_person_id") REFERENCES "people"("id") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_themes" ADD CONSTRAINT "movie_themes_movie_id_fkey" FOREIGN KEY ("movie_id") REFERENCES "movies"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_themes" ADD CONSTRAINT "movie_themes_theme_id_fkey" FOREIGN KEY ("theme_id") REFERENCES "themes"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_countries" ADD CONSTRAINT "movie_countries_movie_id_fkey" FOREIGN KEY ("movie_id") REFERENCES "movies"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_countries" ADD CONSTRAINT "movie_countries_country_id_fkey" FOREIGN KEY ("country_id") REFERENCES "countries"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_languages" ADD CONSTRAINT "movie_languages_movie_id_fkey" FOREIGN KEY ("movie_id") REFERENCES "movies"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "movie_languages" ADD CONSTRAINT "movie_languages_language_id_fkey" FOREIGN KEY ("language_id") REFERENCES "languages"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "filming_locations" ADD CONSTRAINT "filming_locations_movie_id_fkey" FOREIGN KEY ("movie_id") REFERENCES "movies"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "user_ratings" ADD CONSTRAINT "user_ratings_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "user_ratings" ADD CONSTRAINT "user_ratings_movie_id_fkey" FOREIGN KEY ("movie_id") REFERENCES "movies"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "user_watchlist" ADD CONSTRAINT "user_watchlist_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "user_watchlist" ADD CONSTRAINT "user_watchlist_movie_id_fkey" FOREIGN KEY ("movie_id") REFERENCES "movies"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "user_watched" ADD CONSTRAINT "user_watched_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "user_watched" ADD CONSTRAINT "user_watched_movie_id_fkey" FOREIGN KEY ("movie_id") REFERENCES "movies"("id") ON DELETE CASCADE ON UPDATE CASCADE;


```
